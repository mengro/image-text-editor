(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"./src/routes/Board/index.less":function(e,t,a){},"./src/routes/Board/index.mdx":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return ie}));var n=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),r=a("react"),o=a.n(r),l=a("./node_modules/@mdx-js/react/dist/esm.js"),i=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),c=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),s=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),d=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),m=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js"),u=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js"),f=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js"),b=a("./node_modules/antd/es/modal/index.js"),p=a("./node_modules/antd/es/icon/index.js"),g=a("./node_modules/antd/es/empty/index.js"),h=a("./node_modules/fabric/dist/fabric.js"),v=function(e){Object(u.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.boolLimitOn,a=e.onSwitch,n=e.addText;return o.a.createElement("ul",{className:"board-sider-container"},o.a.createElement("li",{onClick:function(e){return a("tab_image")}},o.a.createElement(p.a,{type:"picture"}),o.a.createElement("br",null),o.a.createElement("span",null,"\u56fe\u50cf")),o.a.createElement("li",{className:"".concat(t?"disabled":""),onClick:function(e){return!t&&n()}},o.a.createElement(p.a,{type:"font-size"}),o.a.createElement("br",null),o.a.createElement("span",null,"\u6587\u5b57")),o.a.createElement("li",{onClick:function(e){return a("tab_layer")}},o.a.createElement(p.a,{type:"tags"}),o.a.createElement("br",null),o.a.createElement("span",null,"\u56fe\u5c42")))}}]),a}(r.Component);function j(e){var t=e.children,a=e.visible;return o.a.createElement("div",{className:"board-drawer",style:{width:200,display:a?"block":"none"}},t)}"undefined"!==typeof v&&v&&v===Object(v)&&Object.isExtensible(v)&&Object.defineProperty(v,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"Sider",filename:"src/routes/Board/components/Sider.js"}}),"undefined"!==typeof v&&v&&v===Object(v)&&Object.isExtensible(v)&&Object.defineProperty(v,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"Sider",filename:"src/routes/Board/components/Sider.js"}});var y=j;j&&j===Object(j)&&Object.isExtensible(j)&&Object.defineProperty(j,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"Drawer",filename:"src/routes/Board/components/Drawer.js"}});var O=a("./node_modules/antd/es/input-number/index.js"),x={width:"40%"};"undefined"!==typeof x&&x&&x===Object(x)&&Object.isExtensible(x)&&Object.defineProperty(x,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"halfInputStyle",filename:"src/routes/Board/config.js"}});var E=[{value:"Alibaba-PuHuiTi",label:"Alibaba-PuHuiTi"},{value:"DINSchrift",label:"DINSchrift"}];"undefined"!==typeof E&&E&&E===Object(E)&&Object.isExtensible(E)&&Object.defineProperty(E,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"fontFamilyList",filename:"src/routes/Board/config.js"}});var _=[{label:"\u662f",value:!0},{label:"\u5426",value:!1}];"undefined"!==typeof _&&_&&_===Object(_)&&Object.isExtensible(_)&&Object.defineProperty(_,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"lockedRadioOptions",filename:"src/routes/Board/config.js"}});var w="https://img.gegejia.com/item-adminab3c039c3c4f4a34aa3f69ba6833c946.png";w===Object(w)&&Object.isExtensible(w)&&Object.defineProperty(w,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"defaultTag",filename:"src/routes/Board/config.js"}});var C="https://img.gegejia.com/item-admin/7dbda4dbe65f4f28b406e5c7badfdf11.png";C===Object(C)&&Object.isExtensible(C)&&Object.defineProperty(C,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"background",filename:"src/routes/Board/config.js"}});var k={lockUniScaling:!0,centeredRotation:!0,skipTargetFind:!0,lockScalingX:!0,lockScalingY:!0,locked:!1,fontFamily:"Alibaba-PuHuiTi",fontSize:20,fontWeight:400,fill:"#000000",length:20};"undefined"!==typeof k&&k&&k===Object(k)&&Object.isExtensible(k)&&Object.defineProperty(k,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"defaultTextOptions",filename:"src/routes/Board/config.js"}});var S={lockRotation:!0,angle:0,lockUniScaling:!0};"undefined"!==typeof S&&S&&S===Object(S)&&Object.isExtensible(S)&&Object.defineProperty(S,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"defaultImageOptions",filename:"src/routes/Board/config.js"}});var N={left:0,top:0,width:0,height:0,fill:"#000000"};"undefined"!==typeof N&&N&&N===Object(N)&&Object.isExtensible(N)&&Object.defineProperty(N,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"defaultImageControls",filename:"src/routes/Board/config.js"}});var T={left:0,top:0,angle:0,fontFamily:"",fontWeight:"",lineHeight:0,charSpacing:0,fontSize:20,fill:"#000",text:"",length:20,locked:!1};"undefined"!==typeof T&&T&&T===Object(T)&&Object.isExtensible(T)&&Object.defineProperty(T,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"defaultTextControls",filename:"src/routes/Board/config.js"}});15===Object(15)&&Object.isExtensible(15)&&Object.defineProperty(15,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"totalLimit",filename:"src/routes/Board/config.js"}});var L={locked:!0,fontFamily:"DINSchrift",fontWeight:400,fontSize:22,fill:"#ffffff"},H={locked:!0,fontFamily:"Alibaba-PuHuiTi",fontWeight:700,fontSize:22,fill:"#ffffff"},I=[Object(s.a)(Object(s.a)({},H),{},{text:"\u4f1a\u5458\u5230\u624b\u4ef7",left:600,top:552,length:5}),Object(s.a)(Object(s.a)({},L),{},{text:"\xa5",left:584,top:616,fontSize:50,length:1}),Object(s.a)(Object(s.a)({},L),{},{text:"666",name:"memberPrice",left:608,top:576,fontSize:102,length:20}),Object(s.a)(Object(s.a)({},H),{},{text:"\u65e5\u5e38\u4ef7",left:584,top:672,length:3}),Object(s.a)(Object(s.a)({},L),{},{text:"\xa5",left:650,top:672,length:1}),Object(s.a)(Object(s.a)({},L),{},{text:"999",name:"price",left:661,top:672,length:20})];"undefined"!==typeof I&&I&&I===Object(I)&&Object.isExtensible(I)&&Object.defineProperty(I,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"defaultInitTextsOptions",filename:"src/routes/Board/config.js"}});var P=Object(r.memo)((function(e){var t=e.children,a=e.onChange,n=e.currentImageControls,l={precision:0,style:x};return o.a.createElement(r.Fragment,null,o.a.createElement("ul",{className:"board-controller-container"},o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u4f4d\u7f6e"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(O.a,Object.assign({value:n.left},l,{onChange:function(e){return a("left",e)}})),o.a.createElement(O.a,Object.assign({value:n.top},l,{onChange:function(e){return a("top",e)}})))),o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u5c3a\u5bf8"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(O.a,Object.assign({value:n.width},l,{onChange:function(e){return a("width",e)}})),o.a.createElement("span",{className:"board-controller-lock"},o.a.createElement(p.a,{type:"lock"})),o.a.createElement(O.a,Object.assign({value:n.height},l,{onChange:function(e){return a("height",e)}}))))),o.a.createElement("div",{className:"board-controller-replace"},t),o.a.createElement("ul",{className:"board-controller-tip"},o.a.createElement("li",{className:"board-controller-tip-row"},o.a.createElement(p.a,{type:"info-circle"}),"\u201c\u66ff\u6362\u56fe\u7247\u201d\u8fdb\u884c\u81ea\u5b9a\u4e49\u7d20\u6750\u4e0a\u4f20"),o.a.createElement("li",{className:"board-controller-tip-row"},o.a.createElement(p.a,{type:"info-circle"}),"\u56fe\u7247\u5927\u5c0f\u8bf7\u4e0d\u8981\u8d85\u8fc71MB"),o.a.createElement("li",{className:"board-controller-tip-row"},o.a.createElement(p.a,{type:"info-circle"}),"\u56fe\u7247\u540d\u79f0\u4e0d\u542b\u201c-\u3001%\u201d\u7b49\u7279\u6b8a\u7b26\u53f7"),o.a.createElement("li",{className:"board-controller-tip-row"},o.a.createElement(p.a,{type:"info-circle"}),"\u4e3b\u56fe\u56fe\u6807\u8bf7\u4f7f\u7528png\u683c\u5f0f\u56fe\u7247")))})),B=a("./node_modules/antd/es/radio/index.js"),z=a("./node_modules/antd/es/slider/index.js"),A=a("./node_modules/antd/es/select/index.js"),W=a("./node_modules/antd/es/input/index.js"),M=a("./node_modules/react-color/lib/index.js"),R=function(e){Object(u.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={displayColorPicker:!1},e.handleClick=function(){e.setState({displayColorPicker:!e.state.displayColorPicker})},e.handleClose=function(){e.setState({displayColorPicker:!1})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.value,a=e.onChange,n={container:{width:"100%"},color:{width:"100%",height:"14px",borderRadius:"2px",background:t},swatch:{width:"100%",padding:"5px",marginRight:"10px",background:"#ffffff",borderRadius:"1px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer",verticalAlign:"middle"},popover:{position:"absolute",zIndex:"2"},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}};return o.a.createElement("div",{style:n.container},o.a.createElement("div",{style:n.swatch,onClick:this.handleClick},o.a.createElement("div",{style:n.color})),this.state.displayColorPicker?o.a.createElement("div",{style:n.popover},o.a.createElement("div",{style:n.cover,onClick:this.handleClose}),o.a.createElement(M.SketchPicker,{color:t,onChangeComplete:function(e,t,n){console.log(e,t,n),a(e.hex)}})):null)}}]),a}(r.PureComponent),U=R;"undefined"!==typeof R&&R&&R===Object(R)&&Object.isExtensible(R)&&Object.defineProperty(R,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"ColorPicker",filename:"src/routes/Board/components/ColorPicker.js"}});var F=B.a.Group;var D=Object(r.memo)((function(e){var t=e.onChange,a=e.currentTextControls,n=e.currentActiveLayer,l={precision:0,style:x},i="price"===n.name||"memberPrice"===n.name,c="memberPrice"===n.name?"\u4f1a\u5458\u4ef7":"\u552e\u4ef7";return o.a.createElement(r.Fragment,null,o.a.createElement("ul",{className:"board-controller-container"},o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u4f4d\u7f6e"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(O.a,Object.assign({value:a.left},l,{onChange:function(e){return t("left",e)}})),o.a.createElement(O.a,Object.assign({value:a.top},l,{onChange:function(e){return t("top",e)}})))),o.a.createElement("li",{style:{display:"none"},className:"board-controller-row withBorder"},o.a.createElement("span",{className:"board-controller-label"},"\u65cb\u8f6c"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(z.a,{style:{flex:1},min:0,max:360,onChange:function(e){return t("angle",e)},value:a.angle||0}))),o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u5b57\u4f53"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(A.a,{onChange:function(e){return t("fontFamily",e)},value:a.fontFamily},E.map((function(e){return o.a.createElement(A.a.Option,{value:e.value},e.label)}))))),o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u884c\u8ddd"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(O.a,Object.assign({value:a.lineHeight},l,{precision:1,step:.1,onChange:function(e){return t("lineHeight",e)}})),o.a.createElement("span",{className:"board-controller-lock"},"\u5b57\u8ddd"),o.a.createElement(O.a,Object.assign({value:a.charSpacing},l,{onChange:function(e){return t("charSpacing",e)}})))),o.a.createElement("li",{className:"board-controller-row withBorder"},o.a.createElement("span",{className:"board-controller-label"},"\u5b57\u53f7"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(O.a,Object.assign({value:a.fontSize},l,{onChange:function(e){return t("fontSize",e)}})),o.a.createElement("span",{className:"board-controller-lock"},"\u7c97\u7ec6"),o.a.createElement(O.a,Object.assign({min:300,max:900,step:100,value:a.fontWeight},l,{onChange:function(e){return t("fontWeight",e)}})))),o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u989c\u8272"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(U,{onChange:function(e){return t("fill",e)},value:a.fill}))),o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u5185\u5bb9"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(W.a.TextArea,{readOnly:i,maxLength:20,rows:4,onChange:function(e){return t("text",e.target.value)},value:a.text}))),o.a.createElement("li",{className:"board-controller-row"},o.a.createElement("span",{className:"board-controller-label"},"\u9501\u5b9a"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(F,{onChange:function(e){return t("locked",e.target.value)},value:a.locked,options:_}))),o.a.createElement("li",{className:"board-controller-row ".concat(i?"withBorder":"")},o.a.createElement("span",{className:"board-controller-label"},"\u5b57\u6570"),o.a.createElement("span",{className:"board-controller-inputs"},o.a.createElement(O.a,Object.assign({min:1,max:50,step:1,value:a.length},l,{onChange:function(e){return t("length",e)}})))),i&&o.a.createElement("li",{style:{color:"red",lineHeight:1.2},className:"board-controller-row"},"\u667a\u80fd\u4ef7\u6807-\u3010",c,"\u3011\uff0c\u6295\u653e\u65f6\u4f1a\u6839\u636e\u5546\u54c1\u5b9e\u9645\u7684\u3010",c,"\u3011\u663e\u793a\uff0c\u4ec5\u652f\u6301\u4fee\u6539\u5b9a\u4f4d\u3001\u5b57\u4f53\u3001\u5b57\u53f7\u7b49\uff0c\u65e0\u9700\u4fee\u6539\u6587\u6848")))})),X=a("./node_modules/antd/es/tooltip/index.js"),Y=a("./node_modules/sortablejs/modular/sortable.esm.js"),J=function(e){Object(u.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.call(this)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.onSort,t=document.querySelector("#board-layerList-container");t&&(this.sortList=new Y.a(t,{animation:300,onSort:e}))}},{key:"render",value:function(){var e=this.props,t=e.allLayers,a=e.currentActiveLayer,n=e.onSelect,r=t.filter((function(e){return"\u80cc\u666f\u56fe\u7247"!==e.name})),l=t.find((function(e){return"\u80cc\u666f\u56fe\u7247"===e.name}));return o.a.createElement("div",{className:"layerList-root"},o.a.createElement("h3",{className:"layerList-title"},"\u56fe\u5c42\u5217\u8868",o.a.createElement("i",{className:"layerList-tip"},o.a.createElement(X.a,{placement:"right",title:"\u53ef\u901a\u8fc7\u62d6\u62fd\u56fe\u5c42\u5217\u8868\u5bf9\u5c42\u7ea7\u8fdb\u884c\u8bbe\u5b9a\uff0c\u8d8a\u9760\u524d\u5219\u5bf9\u5e94\u56fe\u5c42\u5c42\u7ea7\u8d8a\u9ad8"},o.a.createElement(p.a,{type:"info-circle"})))),o.a.createElement("ul",{id:"board-layerList-container",className:"layerList-container"},r instanceof Array&&r.map((function(e,t){var r=e.type,l=e.name,i=e.text,c=l;return"text"===r&&(c="".concat(i)),"price"===l&&(c="\u552e\u4ef7"),"memberPrice"===l&&(c="\u4f1a\u5458\u4ef7"),o.a.createElement("li",{onClick:function(t){return n(e)},className:"layerList-row ".concat(a&&a.id===e.id?"active":""),title:c,key:e.id},o.a.createElement("span",{className:"layerList-icon"},"text"===r&&o.a.createElement(p.a,{type:"font-size"}),"image"===r&&o.a.createElement("img",{style:{maxHeight:20,maxWidth:20},src:e.getSrc(),alt:""})),o.a.createElement("span",{className:"layerList-name"},c))}))),o.a.createElement("div",{onClick:function(e){return n(l)},className:"layerList-row ".concat(a&&a.id===l.id?"active":""),title:l.name,key:l.id},o.a.createElement("span",{className:"layerList-icon"},o.a.createElement("img",{style:{maxHeight:20,maxWidth:20},src:l.getSrc(),alt:""})),o.a.createElement("span",{className:"layerList-name"},l.name)))}}]),a}(r.Component);"undefined"!==typeof J&&J&&J===Object(J)&&Object.isExtensible(J)&&Object.defineProperty(J,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"LayerList",filename:"src/routes/Board/components/LayerList.js"}}),"undefined"!==typeof J&&J&&J===Object(J)&&Object.isExtensible(J)&&Object.defineProperty(J,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"LayerList",filename:"src/routes/Board/components/LayerList.js"}});var V=a("./node_modules/antd/es/message/index.js"),q=a("./node_modules/antd/es/upload/index.js"),G=a("./node_modules/antd/es/button/index.js"),K=function(e){Object(u.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).state={loading:!1},e.handleChange=function(t){var a=t.file,n=e.props;n.sortable;if(!n.disabled){if("uploading"===a.status)return e.setState({loading:!0});e.setState({loading:!1});var r=e.props.onChange;if("error"===a.status)return V.a.error("\u4e0a\u4f20\u5931\u8d25"),!1;if(a.response&&30600042===a.response.code)V.a.warn(a.response.message),a.response.code=1;else if(a.response&&1!==a.response.code)return V.a.error(a.response.message),!1;r(a.response.data&&a.response.data.url)}},e.beforeUpload=function(t){var a=e.props.limitSize,n=void 0===a?10485760:a;if(n&&t.size>1024*n)return V.a.warn("\u56fe\u7247\u5927\u5c0f\u987b\u5c0f\u4e8e".concat(n,"KB")),Promise.reject();var r=e.props.allowTypeList,o=void 0===r?["image/jpeg","image/png","image/jpg","image/gif","image/bmp"]:r,l=t.type;if(o.indexOf(l)<0)return V.a.error("\u8bf7\u4e0a\u4f20".concat(o.map((function(e){return e.replace("image/","")})).join("\u3001"),"\u683c\u5f0f\u7684\u56fe\u7247")),Promise.reject();var i=e.props.imageRules;if(i){var c=i.minWidth,s=void 0===c?0:c,d=i.minHeight,m=void 0===d?0:d,u=i.maxHeight,f=void 0===u?3e3:u,b=i.maxWidth,p=void 0===b?3e3:b;if(s||m||f||p){var g=!1,h=new Image;return h.src=window.URL.createObjectURL(t),new Promise((function(e,t){h.onload=function(){var a=h.width,n=h.height;a>=s&&n>=m&&a<=p&&n<=f&&(g=!0),g?e():(V.a.error("\u56fe\u7247\u5c3a\u5bf8\u4e0d\u5408\u6cd5\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20"),t())}}))}}return!0},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.antdOptions,a=e.action,n=e.disabled,r=e.buttonOptions,l=void 0===r?{}:r,i=e.buttonText,c=void 0===i?"\u4e0a\u4f20":i,s=this.state.loading;return o.a.createElement("div",null,o.a.createElement(q.a,Object.assign({name:"file",multiple:!1,action:a,disabled:n,onPreview:this.handlePreview,onChange:this.handleChange,withCredentials:!0,beforeUpload:this.beforeUpload,showUploadList:!1},t,{headers:{"x-referer":location.href,Accept:"application/json"}}),o.a.createElement(G.a,Object.assign({loading:s,type:"primary"},l),c)))}}]),a}(r.Component);"undefined"!==typeof K&&K&&K===Object(K)&&Object.isExtensible(K)&&Object.defineProperty(K,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"ImageUpload",filename:"src/routes/Board/components/ImageUpload.js"}}),"undefined"!==typeof K&&K&&K===Object(K)&&Object.isExtensible(K)&&Object.defineProperty(K,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"ImageUpload",filename:"src/routes/Board/components/ImageUpload.js"}});var Q=a("./node_modules/axios/index.js"),Z=a.n(Q),$="".concat("https://apigwdev.gegejia.com/item-admin-mng","/file/imageUpload");function ee(e){return Z.a.post("/file/imageUpload",e)}"undefined"!==typeof $&&$&&$===Object($)&&Object.isExtensible($)&&Object.defineProperty($,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"uploadImageAction",filename:"src/services.js"}}),ee&&ee===Object(ee)&&Object.isExtensible(ee)&&Object.defineProperty(ee,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"uploadImage",filename:"src/services.js"}});var te=function(e){return Object.keys(e).forEach((function(t){void 0===e[t]&&delete e[t],null===e[t]&&delete e[t]})),e};te&&te===Object(te)&&Object.isExtensible(te)&&Object.defineProperty(te,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"filterUndefined",filename:"src/utils/index.js"}});var ae=function(e,t){var a=Object(s.a)({},e);return Object.keys(e).forEach((function(e){e in t&&(a[e]=t[e])})),a};ae&&ae===Object(ae)&&Object.isExtensible(ae)&&Object.defineProperty(ae,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"copyProperties",filename:"src/utils/index.js"}});var ne=function(e,t,a){return e.lastModifiedDate=new Date,e.name=t,new window.File([e],t,{type:a})};ne&&ne===Object(ne)&&Object.isExtensible(ne)&&Object.defineProperty(ne,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"blobToFile",filename:"src/utils/index.js"}});var re=function(e){var t=new Image;return new Promise((function(a,n){t.onload=function(){a({img:this,width:t.width,height:t.height})},t.onerror=function(){n()},t.setAttribute("crossOrigin","anonymous"),t.src=e}))};re&&re===Object(re)&&Object.isExtensible(re)&&Object.defineProperty(re,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"loadImg",filename:"src/utils/index.js"}});a("./src/routes/Board/index.less");var oe=function(e){Object(u.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).initBoard=function(){var t=e.props,a=t.boolIsEcho,n=t.echoLayers;e.canvasWidth=e.containerRef.clientWidth,e.canvasHeight=e.containerRef.clientHeight,e.canvas=new h.fabric.Canvas("fabric-root",{width:e.canvasWidth,height:e.canvasHeight,preserveObjectStacking:!0}),e.addImageHandle(C,{lockScalingX:!0,lockScalingY:!0,name:"\u80cc\u666f\u56fe\u7247"}).then((function(t){e.backgroundImage=t,e.backgroundImageObject=t.toObject(),a?n instanceof Array&&e.echoLayersHandle(n):e.addImageHandle(w,{name:"\u9ed8\u8ba4\u6a21\u677f"}).then((function(t){e.selectLayerHandle(t),e.addDefaultTexts()}))}))},e.addDefaultTexts=function(){I.forEach((function(t){e.addTextHandle(t)}))},e.echoLayersHandle=function(t){var a=e.backgroundImageObject,n=a.left,r=a.top;t instanceof Array&&t.forEach((function(t,a){if("image"===t.type&&t.src&&e.addImageHandle(t.src,{left:n+t.left,top:r+t.top},t.width,t.height,t.zindex),"text"===t.type&&t.text){var o=te(Object(s.a)(Object(s.a)({},t),{},{text:t.writing,left:n+t.left,top:r+t.top,name:t.name,fill:t.color}));e.addTextHandle(o,t.zindex)}}))},e.getValue=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.onlyImages,n=void 0!==a&&a,r=t.onlyTexts,o=void 0!==r&&r,l=t.toObject,i=void 0!==l&&l,c=t.relative,d=void 0===c||c,m=t.sorted,u=void 0===m||m,f=e.canvas.getObjects();if(f instanceof Array){if(f=f.filter((function(e){return"\u80cc\u666f\u56fe\u7247"!==e.name})),i&&(f=f.map((function(e){return Object(s.a)(Object(s.a)({},e.toObject()),{},{name:e.name})}))),n&&(f=f.filter((function(e){return"image"===e.type}))),o&&(f=f.filter((function(e){return"text"===e.type}))),d){var b=e.backgroundImageObject,p=b.left,g=b.top;f=f.map((function(e){var t=e.toObject().lineHeight,a=Object(s.a)(Object(s.a)({},e),{},{left:e.left-p,top:e.top-g,src:e.getSrc&&e.getSrc(),lineHeight:t});return e.scaleX&&(a.width=Math.round(e.width*e.scaleX)),e.scaleY&&(a.height=Math.round(e.height*e.scaleY)),a}))}if(u){var h=f.sort((function(e,t){return e.zindex-t.zindex}));return h}return f}return[]},e.getMergedImage=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.withTexts;return new Promise((function(t,a){var n=e.getValue({onlyImages:!0,toObject:!1}),r=document.createElement("canvas"),o=r.getContext("2d");re(e.backgroundImageObject.src).then((function(l){r.width=e.backgroundImageObject.width,r.style.width=e.backgroundImageObject.width,r.height=e.backgroundImageObject.height,r.style.height=e.backgroundImageObject.height;var i=n.map((function(e){return re(e.src)}));return Promise.all(i).then((function(l){l instanceof Array&&l.forEach((function(e,t){var a=n[t],r=a.left,l=a.top;o.drawImage(e.img,r,l,a.width,a.height)})),r.toBlob((function(n){e.uploadImage(n).then((function(e){return e&&e.url?t(e.url):a()})).catch((function(e){return a(e)}))}),"image/png")}))})).catch(a)}))},e.uploadImage=function(e){var t=new FormData,a=ne(e,"imageTag.png","image/png");return t.append("file",a),ee(t)},e.switchHandle=function(t){e.setState({currentTab:e.state.currentTab?"":t})},e.getCenter=function(t){var a=t.width,n=t.height;return{left:Math.round((e.canvasWidth-a)/2/e.distance)*e.distance,top:Math.round((e.canvasHeight-n)/2/e.distance)*e.distance}},e.addImageHandle=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return console.log(o),new Promise((function(l){h.fabric.Image.fromURL(t,(function(t){t.type="image";var i=t.width,c=t.height,d=e.getCenter({width:i,height:c}),m=d.left,u=d.top;t.originWidth=i,t.originHeight=c,t.set(Object(s.a)(Object(s.a)({},S),{},{left:m,top:u},a)),n&&t.scaleToWidth(n),r&&t.scaleToHeight(r),e.imageCount++,a.name||(t.name="\u9759\u6001\u56fe\u7247-".concat(e.imageCount)),t.id="imgInstance-".concat(e.imageCount),e.addLayer(t,o),t.on("moving",(function(a){return e.commonMoveHandle(a,"selected_image",t)})).on("selected",(function(a){return e.commonSelectHandle(a,"selected_image",t)})).on("scaling",e.commonScaleHandle).on("deselected",e.commonUnselectHandle),l(t)}))}))},e.addTextHandle=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,n=t.text,r=t.name,o=t.left,l=t.top,i=t.fill,c=void 0===i?k.fill:i,d=t.fontSize,m=void 0===d?k.fontSize:d,u=t.fontWeight,f=void 0===u?k.fontWeight:u,b=t.length,p=void 0===b?k.length:b,g=t.fontFamily,v=void 0===g?k.fontFamily:g,j=t.locked,y=void 0===j?k.locked:j,O=300,x=20,E=e.getCenter({width:O,height:x}),_=new h.fabric.IText(n||"\u8f93\u5165\u6587\u672c",Object(s.a)(Object(s.a)({},k),{},{left:o||E.left,top:l||E.top,width:O,height:x,name:r,fill:c,fontSize:m,fontWeight:f,fontFamily:v,length:p,locked:y}));return _.type="text",_.on("moving",(function(t){return e.commonMoveHandle(t,"selected_text",_)})).on("selected",(function(t){return e.commonSelectHandle(t,"selected_text",_)})).on("rotating",(function(t){return e.commonRotatingHandle(t,"selected_text",_)})).on("deselected",e.commonUnselectHandle),_.id="textInstance-".concat(++e.textCount),e.addLayer(_,a),_},e.commonMoveHandle=function(t,a,n){n.left=Math.round(n.left/e.distance)*e.distance,n.top=Math.round(n.top/e.distance)*e.distance,"selected_image"===a&&e.updateImageControls(Object(s.a)(Object(s.a)({},n),{},{width:n.scaleX*n.width,height:n.scaleY*n.height})),"selected_text"===a&&e.updateTextControls(n)},e.commonScaleHandle=function(t){var a=t.target,n=a.scaleX,r=a.scaleY,o=a.left,l=a.top,i=Math.round(n*a.originWidth),c=Math.round(r*a.originHeight);e.updateImageControls({width:i,height:c,left:o,top:l})},e.commonRotatingHandle=function(t,a,n){"selected_text"===a&&e.updateTextControls(n)},e.commonSelectHandle=function(t,a,n){"selected_image"===a&&e.updateImageControls(Object(s.a)(Object(s.a)({},n),{},{width:n.scaleX?n.scaleX*n.width:n.width,height:n.scaleY?n.scaleY*n.height:n.height})),"selected_text"===a&&e.updateTextControls(n),e.setState({currentSelectType:a,currentActiveLayer:n}),e.currentTarget=n},e.commonUnselectHandle=function(){e.setState({currentSelectType:""}),e.currentTarget=null},e.selectLayerHandle=function(t){e.canvas.setActiveObject(t).renderAll(),e.setState({currentActiveLayer:t})},e.sortSideBarLayerHandle=function(t){var a=t.newIndex,n=t.oldIndex,r=e.state.allLayers,o=r.length-1-a,l=r.length-1-n;r.forEach((function(e){if(e.zindex===l)return e.zindex=o;o>l?e.zindex>l&&e.zindex<=o&&(e.zindex=e.zindex-1):e.zindex<l&&e.zindex>=o&&(e.zindex=e.zindex+1)}));var i=e.sortBoardLayersHandle(r);e.setState({allLayers:Object(c.a)(i)})},e.sortBoardLayersHandle=function(t){var a=t.sort((function(e,t){return t.zindex-e.zindex}));return e.canvas.clear(),a.slice().reverse().forEach((function(t){return e.canvas.add(t)})),a},e.uploadHandle=function(t){e.setState({currentTab:""}),t&&e.addImageHandle(t)},e.replaceHandle=function(t){t&&e.currentTarget.setSrc(t,(function(t){return e.canvas.renderAll(),t}))},e.updateImageRender=function(t,a){if("width"===t||"height"===t){"width"===t&&e.currentTarget.scaleToWidth(a),"height"===t&&e.currentTarget.scaleToHeight(a);var n=e.currentTarget,r=n.scaleX,o=n.scaleY,l=n.originWidth,c=n.originHeight;e.updateImageControls({width:l*r,height:c*o})}else e.updateImageControls(Object(i.a)({},t,a)),e.currentTarget.set(t,a);e.canvas.renderAll()},e.updateImageControls=function(t){var a=Object(s.a)({},t);t.width&&(a.width=Math.round(t.width)),t.height&&(a.height=Math.round(t.height)),e.setState({currentImageControls:ae(e.state.currentImageControls,a)})},e.updateTextRender=function(t,a){"angle"===t?e.currentTarget.rotate(a):("fill"===t&&e.currentTarget.setColor(a),e.currentTarget[t]=a),e.canvas.renderAll(),e.updateTextControls(e.currentTarget)},e.updateTextControls=function(t){e.setState({currentTextControls:ae(e.state.currentTextControls,t)})},e.addLayer=function(t,a){var n=e.state.allLayers;t.zindex=void 0!==a&&null!==a?a:n.length,e.canvas.add(t);var r=e.canvas.getObjects(),o=e.sortBoardLayersHandle(r);e.setState({allLayers:o})},e.deleteLayerHandle=function(t){var a=e.state,n=a.currentActiveLayer,r=a.allLayers,o=function(){var t=r.filter((function(e){return e!==n})),a=e.sortBoardLayersHandle(t).map((function(e){return e.zindex>n.zindex&&e.zindex>1&&(e.zindex=e.zindex-1),e}));e.setState({allLayers:a}),e.canvas.remove(n)};if(n.locked)return b.a.confirm({title:"\u786e\u5b9a\u5220\u9664\u5417\uff1f",content:"\u5220\u9664\u4ef7\u683c\u56fe\u5c42\u5c06\u5bfc\u81f4\u4e3b\u56fe\u4e0d\u80fd\u6b63\u5e38\u5c55\u793a\u4ef7\u683c\uff0c\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",onOk:function(){return o()}});o()},e.changeIndexHandle=function(t){var a=e.state.currentActiveLayer;"up"===t?a.bringToFront():a.sendToBack()},e.state={currentTab:"",currentSelectType:"",currentImageControls:N,currentTextControls:T,allLayers:[],currentActiveLayer:null},e.currentTarget=null,e.distance=8,e.imageCount=0,e.textCount=0,e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.initBoard()}},{key:"render",value:function(){var e=this,t=this.state,a=t.currentTab,n=t.currentSelectType,r=t.currentImageControls,l=t.currentTextControls,i=t.allLayers,c=t.currentActiveLayer,s=this.props.children,d=i.length>=15;return o.a.createElement("div",{className:"board-container"},o.a.createElement("aside",{className:"board-components"},o.a.createElement(v,{addText:function(t){return e.addTextHandle()},onSwitch:this.switchHandle,boolLimitOn:d}),o.a.createElement(y,{visible:"tab_image"===a||"tab_layer"===a},"tab_image"===a&&o.a.createElement("div",{style:{marginTop:32}},o.a.createElement(K,{sortable:!1,limit:1,action:$,buttonText:"\u672c\u5730\u4e0a\u4f20",onChange:this.uploadHandle,buttonOptions:{disabled:d}})),"tab_layer"===a&&o.a.createElement(J,{currentActiveLayer:c,allLayers:i,onSelect:this.selectLayerHandle,onSort:this.sortSideBarLayerHandle}))),o.a.createElement("section",{className:"board-body"},o.a.createElement("div",{ref:function(t){return e.containerRef=t},className:"boardBody-container"},o.a.createElement("div",{className:"board-layer-counter"},"\u5df2\u6dfb\u52a0\u56fe\u5c42 ".concat(i.length," / ").concat(15)),o.a.createElement("canvas",{className:"fabric-root",id:"fabric-root"}),n&&o.a.createElement("div",{className:"boardBody-operator"},"\u80cc\u666f\u56fe\u7247"!==c.name&&o.a.createElement("div",{className:"boardBody-operator-delete icon"},o.a.createElement(p.a,{onClick:this.deleteLayerHandle,type:"delete"}))))),o.a.createElement("aside",{className:"board-controller"},"selected_image"===n&&o.a.createElement(P,{onChange:this.updateImageRender,currentImageControls:r},o.a.createElement(K,{sortable:!1,limit:1,action:$,buttonOptions:{style:{width:"240px"}},buttonText:"\u66ff\u6362\u56fe\u7247",onChange:this.replaceHandle})),"selected_text"===n&&o.a.createElement(D,{currentTextControls:l,onChange:this.updateTextRender,currentActiveLayer:c}),""===n&&o.a.createElement(g.a,{style:{marginTop:100,color:"#aaa"},description:"\u672a\u9009\u62e9\u56fe\u5c42"}),o.a.createElement("div",{className:"board-baseInfo"},s)))}}]),a}(r.PureComponent);"undefined"!==typeof oe&&oe&&oe===Object(oe)&&Object.isExtensible(oe)&&Object.defineProperty(oe,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"Board",filename:"src/routes/Board/index.js"}}),"undefined"!==typeof oe&&oe&&oe===Object(oe)&&Object.isExtensible(oe)&&Object.defineProperty(oe,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"Board",filename:"src/routes/Board/index.js"}});a("./src/style/index.less");var le={};function ie(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(l.b)("wrapper",Object.assign({},le,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h1",{id:"board-component"},"Board Component"),Object(l.b)(oe,{mdxType:"Board"}))}ie&&ie===Object(ie)&&Object.isExtensible(ie)&&Object.defineProperty(ie,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"src/routes/Board/index.mdx"}}),ie.isMDXComponent=!0},"./src/style/index.less":function(e,t,a){},1:function(e,t){},2:function(e,t){},3:function(e,t){}}]);